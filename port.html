<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <!-- Firebase SDKs loaded FIRST in head section -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
      :root {
        --primary: #4361ee;
        --secondary: #3f37c9;
        --success: #4cc9f0;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #6c757d;
        --border-radius: 12px;
        --box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--dark);
        background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        transition: var(--transition);
      }

      body[dir="rtl"] {
        font-family: "Tajawal", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .container {
        width: 100%;
        max-width: 1000px;
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
        transition: var(--transition);
      }

      .card-header {
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        color: white;
        padding: 20px 30px;
        text-align: center;
      }

      .card-body {
        padding: 30px;
      }

      .logo {
        font-size: 2.2rem;
        margin-bottom: 15px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .card-title {
        font-size: 1.8rem;
        font-weight: 600;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--dark);
      }

      input,
      select {
        width: 100%;
        padding: 14px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      }

      .btn {
        display: inline-block;
        background: var(--primary);
        color: white;
        border: none;
        padding: 14px 25px;
        font-size: 1rem;
        font-weight: 500;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        text-align: center;
        text-decoration: none;
      }

      .btn:hover {
        background: var(--secondary);
        transform: translateY(-2px);
      }

      .btn-block {
        display: block;
        width: 100%;
      }

      .btn-outline {
        background: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
      }

      .btn-outline:hover {
        background: var(--primary);
        color: white;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 500;
      }

      .alert-error {
        background: rgba(239, 68, 68, 0.15);
        color: #ef4444;
        border: 1px solid #ef4444;
      }

      .alert-success {
        background: rgba(34, 197, 94, 0.15);
        color: #22c55e;
        border: 1px solid #22c55e;
      }

      .project-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .project-item {
        background: #f8fafc;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
        border-left: 4px solid var(--primary);
      }

      .project-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      .project-label {
        font-weight: 500;
        color: var(--gray);
        font-size: 0.9rem;
        margin-bottom: 5px;
        display: block;
      }

      .project-value {
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--dark);
      }

      .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .status-active {
        background: rgba(34, 197, 94, 0.2);
        color: #16a34a;
      }

      .status-expired {
        background: rgba(239, 68, 68, 0.2);
        color: #dc2626;
      }

      .status-maintenance {
        background: rgba(245, 158, 11, 0.2);
        color: #d97706;
      }

      .project-url {
        color: var(--primary);
        text-decoration: none;
        word-break: break-all;
        display: block;
        margin-top: 5px;
        transition: var(--transition);
      }

      .project-url:hover {
        color: var(--secondary);
        text-decoration: underline;
      }

      .lang-switch {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: white;
        border: 1px solid #ddd;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
      }

      .lang-switch:hover {
        transform: rotate(30deg);
      }

      .lang-switch i {
        font-size: 1.2rem;
        color: var(--primary);
      }

      .hidden {
        display: none;
      }

      footer {
        text-align: center;
        margin-top: 20px;
        color: var(--gray);
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        .card-body {
          padding: 20px;
        }

        .card-header {
          padding: 15px 20px;
        }

        .logo {
          font-size: 1.8rem;
        }

        .card-title {
          font-size: 1.5rem;
        }

        .project-grid {
          grid-template-columns: 1fr;
        }

        .lang-switch {
          top: 15px;
          right: 15px;
          width: 45px;
          height: 45px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .container {
          margin: 10px auto;
        }

        .card-body {
          padding: 15px;
        }

        .form-group {
          margin-bottom: 15px;
        }

        input,
        select,
        .btn {
          padding: 12px;
        }
      }

      [dir="rtl"] {
        text-align: right;
        direction: rtl;
      }

      [dir="rtl"] .logo i {
        margin-left: 10px;
        margin-right: 0;
      }

      [dir="rtl"] .lang-switch {
        right: auto;
        left: 20px;
      }

      [dir="rtl"] .project-item {
        border-left: none;
        border-right: 4px solid var(--primary);
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(67, 97, 238, 0.2);
        border-top: 5px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .config-warning {
        background-color: #fff8e1;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        font-size: 0.95rem;
      }

      .no-firebase-warning {
        background-color: #ffebee;
        border-left: 4px solid #f44336;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        font-size: 0.95rem;
      }
      
      .demo-mode-warning {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        font-size: 0.95rem;
      }
      
      /* ŸÜŸÖÿ∑ ÿ¨ÿØŸäÿØ ŸÑŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ© */
      .critical-warning {
        background-color: #ffecb3;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 12px;
        margin: 15px 0;
        font-weight: 500;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="lang-switch" id="langSwitch">
      <i class="fas fa-language"></i>
    </div>

    <div class="container">
      <div id="loginPage" class="card">
        <div class="card-header">
          <div class="logo">
            <i class="fas fa-shield-alt"></i>
            <div class="card-title" data-i18n="loginTitle">
              Project Portal Login
            </div>
          </div>
        </div>
        <div class="card-body">
          <div id="loginAlert" class="alert hidden" role="alert"></div>

          <div class="config-warning hidden" id="configWarning">
            <strong>Configuration Required:</strong> Firebase is not configured.
            Replace the firebaseConfig object in the script with your Firebase
            project details.
          </div>

          <div class="no-firebase-warning hidden" id="noFirebaseWarning">
            <strong>Connection Issue:</strong> Unable to connect to Firebase. 
            Please ensure you're running this from a proper web server and not directly from a file.
          </div>
          
          <div class="demo-mode-warning hidden" id="demoModeWarning">
            <strong>Demo Mode:</strong> Running in demo mode. For real functionality, deploy to a web server with proper Firebase configuration.
          </div>

          <form id="loginForm">
            <div class="form-group">
              <label for="projectUrl" data-i18n="urlField">Project URL</label>
              <input
                type="url"
                id="projectUrl"
                placeholder="https://example.com"
                required
              />
            </div>

            <div class="form-group">
              <label for="projectId" data-i18n="idField">Project ID</label>
              <input
                type="text"
                id="projectId"
                placeholder="PROJ-123"
                required
              />
            </div>

            <button
              type="submit"
              class="btn btn-block"
              id="loginBtn"
              data-i18n="loginBtn"
            >
              <span id="loginBtnText">Login to Portal</span>
              <span id="loginSpinner" class="spinner hidden"></span>
            </button>
          </form>
        </div>
      </div>

      <div id="portalPage" class="card hidden">
        <div class="card-header">
          <div class="logo">
            <i class="fas fa-tachometer-alt"></i>
            <div class="card-title" data-i18n="portalTitle">
              Project Dashboard
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="alert alert-success" id="welcomeMessage">
            <span data-i18n="welcomeMessage">Welcome back,</span>
            <strong id="customerNameDisplay"></strong>!
          </div>

          <div id="portalContent">
            <div class="loading hidden">
              <div class="spinner"></div>
            </div>

            <div class="project-grid">
              <div class="project-item">
                <span class="project-label" data-i18n="customerName"
                  >Customer Name</span
                >
                <span class="project-value" id="customerName"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectId"
                  >Project ID</span
                >
                <span class="project-value" id="projectIdDisplay"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectName"
                  >Project Name</span
                >
                <span class="project-value" id="projectName"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="deploymentDate"
                  >Deployment Date</span
                >
                <span class="project-value" id="deploymentDate"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="supportEndDate"
                  >Support End Date</span
                >
                <span class="project-value" id="supportEndDate"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="supportStatus"
                  >Support Status</span
                >
                <span class="project-value">
                  <span id="supportStatus" class="status-badge"></span>
                </span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectStatus"
                  >Project Status</span
                >
                <span class="project-value">
                  <span id="projectStatus" class="status-badge"></span>
                </span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectUrl"
                  >Project URL</span
                >
                <a
                  href="#"
                  id="projectUrlLink"
                  class="project-url"
                  target="_blank"
                ></a>
              </div>
            </div>
          </div>

          <div style="margin-top: 30px; text-align: center">
            <button
              class="btn btn-outline"
              id="logoutBtn"
              data-i18n="logoutBtn"
            >
              <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p data-i18n="footerText">
        Project Portal System &copy; 2025 | Secure Cloud Management
      </p>
    </footer>

    <script>
      // ‚ö†Ô∏è IMPORTANT: REPLACE WITH YOUR ACTUAL FIREBASE CONFIG ‚ö†Ô∏è
      const firebaseConfig = {
        apiKey: "AIzaSyAemoGMX1PHF55qUTh_5SZIrN3Y-QaqrWA",
        authDomain: "yossef-dev-216b0.firebaseapp.com",
        projectId: "yossef-dev-216b0",
        storageBucket: "yossef-dev-216b0.firebasestorage.app",
        messagingSenderId: "509948939620",
        appId: "1:509948939620:web:017b806e995bb114d8be71",
      };

      let db = null;
      let isFirebaseReady = false;
      let isDemoMode = false;
      let appInitialized = false;
      let currentLang = "en";

      // ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™
      const translations = {
        en: {
          loginTitle: "Project Portal Login",
          urlField: "Project URL",
          idField: "Project ID",
          loginBtn: "Login to Portal",
          portalTitle: "Project Dashboard",
          welcomeMessage: "Welcome back,",
          customerName: "Customer Name",
          projectId: "Project ID",
          projectName: "Project Name",
          deploymentDate: "Deployment Date",
          supportEndDate: "Support End Date",
          supportStatus: "Support Status",
          projectStatus: "Project Status",
          projectUrl: "Project URL",
          logoutBtn: "Logout",
          footerText: "Project Portal System &copy; 2025 | Secure Cloud Management",
          loginError: "Invalid URL or Project ID. Please try again.",
          loginSuccess: "Login successful! Redirecting to portal...",
          logoutSuccess: "You have been successfully logged out.",
          configNotice: "Configuration Required:",
          configMessage: "Firebase is not configured. Replace the firebaseConfig object in the script with your Firebase project details.",
          systemError: "System error: Please contact administrator.",
          firebaseError: "Firebase initialization failed. Please check configuration.",
          demoModeLoginMessage: "Demo mode: Use URL: https://example.com and Project ID: DEMO123",
          demoModeNotice: "Running in demo mode. Real Firebase functionality requires proper deployment.",
          environmentWarning: "This page is running in a limited environment. For full functionality, deploy to a web server."
        },
        ar: {
          loginTitle: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          urlField: "ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          idField: "ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          loginBtn: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑŸÑÿ®Ÿàÿßÿ®ÿ©",
          portalTitle: "ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          welcomeMessage: "ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ÿπŸàÿØÿ™ŸÉÿå",
          customerName: "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ",
          projectId: "ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          projectName: "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          deploymentDate: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜÿ¥ÿ±",
          supportEndDate: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿØÿπŸÖ",
          supportStatus: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿØÿπŸÖ",
          projectStatus: "ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          projectUrl: "ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
          logoutBtn: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
          footerText: "ŸÜÿ∏ÿßŸÖ ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ &copy; 2025 | ÿ•ÿØÿßÿ±ÿ© ÿ≥ÿ≠ÿßÿ®Ÿäÿ© ÿ¢ŸÖŸÜÿ©",
          loginError: "ÿ±ÿßÿ®ÿ∑ ÿ£Ÿà ŸÖÿπÿ±ŸÅ ŸÖÿ¥ÿ±Ÿàÿπ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
          loginSuccess: "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠! ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™Ÿàÿ¨ŸäŸá ÿ•ŸÑŸâ ÿßŸÑÿ®Ÿàÿßÿ®ÿ©...",
          logoutSuccess: "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠.",
          configNotice: "ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÖÿ∑ŸÑŸàÿ®ÿ©:",
          configMessage: "Firebase ÿ∫Ÿäÿ± ŸÖÿ∂ÿ®Ÿàÿ∑. ÿßÿ≥ÿ™ÿ®ÿØŸÑ ŸÉÿßÿ¶ŸÜ firebaseConfig ŸÅŸä ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ÿßŸÑŸÜÿµŸä ÿ®ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ¥ÿ±Ÿàÿπ Firebase ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ.",
          systemError: "ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ: Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ.",
          firebaseError: "ŸÅÿ¥ŸÑ ÿ™ŸáŸäÿ¶ÿ© Firebase. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ŸáŸäÿ¶ÿ©.",
          demoModeLoginMessage: "Ÿàÿ∂ÿπ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™Ÿàÿ∂Ÿäÿ≠Ÿä: ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ±ÿßÿ®ÿ∑: https://example.com ŸàŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ: DEMO123",
          demoModeNotice: "ŸäÿπŸÖŸÑ ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™Ÿàÿ∂Ÿäÿ≠Ÿä. Ÿàÿ∏ÿßÿ¶ŸÅ Firebase ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ© ÿ™ÿ™ÿ∑ŸÑÿ® ŸÜÿ¥ÿ±Ÿãÿß ÿµÿ≠Ÿäÿ≠Ÿãÿß.",
          environmentWarning: "Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ© ÿ™ÿπŸÖŸÑ ŸÅŸä ÿ®Ÿäÿ¶ÿ© ŸÖÿ≠ÿØŸàÿØÿ©. ŸÑŸÑŸàÿ∏ÿßÿ¶ŸÅ ÿßŸÑŸÉÿßŸÖŸÑÿ©ÿå ÿßŸÜÿ¥ÿ±Ÿáÿß ÿπŸÑŸâ ÿÆÿßÿØŸÖ ŸàŸäÿ®."
        },
      };

      // ÿØÿßŸÑÿ© ÿ¢ŸÖŸÜÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿπŸÜÿßÿµÿ±
      function byId(id) {
        return document.getElementById(id);
      }

      // ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿπŸÜÿµÿ± ŸÖÿπŸäŸÜ
      function waitForElement(id, timeout = 3000) {
        return new Promise((resolve) => {
          const element = byId(id);
          if (element) {
            resolve(element);
            return;
          }
          
          const startTime = Date.now();
          const checkInterval = setInterval(() => {
            const element = byId(id);
            if (element) {
              clearInterval(checkInterval);
              resolve(element);
            } else if (Date.now() - startTime > timeout) {
              clearInterval(checkInterval);
              resolve(null);
            }
          }, 100);
        });
      }

      // ŸÉÿ¥ŸÅ ÿßŸÑÿ®Ÿäÿ¶ÿ©
      function detectEnvironment() {
        const isFileProtocol = window.location.protocol === 'file:';
        const isVSCodeWebView = window.location.href.includes('vscode-webview') || 
                               window.location.href.includes('vscode-extension');
        const isLocalhost = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
        
        if (isFileProtocol || isVSCodeWebView) {
          isDemoMode = true;
          console.log("‚úÖ Running in DEMO MODE (environment limitation)");
          return;
        }
        
        try {
          // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ŸÉŸàŸäŸÜ Firebase
          if (!firebaseConfig.apiKey || 
              firebaseConfig.apiKey.trim() === "" || 
              firebaseConfig.apiKey === "AIzaSyAemoGMX1PHF55qUTh_5SZIrN3Y-QaqrWA") {
            isDemoMode = true;
            console.log("‚úÖ Running in DEMO MODE (default Firebase config)");
            return;
          }
          
          isDemoMode = false;
          console.log("‚úÖ Running in REAL MODE (Firebase enabled)");
        } catch (e) {
          isDemoMode = true;
          console.log("‚úÖ Running in DEMO MODE (Firebase error)");
        }
      }

      // ÿ™ŸáŸäÿ¶ÿ© Firebase
      function initFirebase() {
        if (isDemoMode) {
          console.log("‚ÑπÔ∏è Skipping Firebase initialization in demo mode");
          return;
        }
        
        try {
          if (typeof firebase === 'undefined') {
            throw new Error("Firebase SDK not loaded");
          }
          
          firebase.initializeApp(firebaseConfig);
          db = firebase.firestore();
          isFirebaseReady = true;
          console.log("‚úÖ Firebase initialized successfully");
          return true;
        } catch (error) {
          console.error("‚ùå Firebase initialization failed:", error);
          
          // ÿ•ÿ∏Ÿáÿßÿ± ÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™ ŸÖŸÜÿßÿ≥ÿ®ÿ©
          const configWarning = byId("configWarning");
          const noFirebaseWarning = byId("noFirebaseWarning");
          
          if (configWarning) configWarning.classList.remove("hidden");
          if (noFirebaseWarning) noFirebaseWarning.classList.remove("hidden");
          
          isDemoMode = true;
          return false;
        }
      }

      // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÑÿ∫ÿ©
      async function initLanguage() {
        currentLang = localStorage.getItem("portalLang") || "en";
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ™ÿ±ÿ¨ŸÖÿ©
        document.querySelectorAll("[data-i18n]").forEach(element => {
          const key = element.getAttribute("data-i18n");
          if (translations[currentLang][key]) {
            element.textContent = translations[currentLang][key];
          }
        });
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÑÿ∫ÿ©
        const loginBtnText = await waitForElement("loginBtnText", 1000);
        if (loginBtnText) {
          loginBtnText.textContent = translations[currentLang].loginBtn;
        }
        
        const logoutBtn = await waitForElement("logoutBtn", 1000);
        if (logoutBtn) {
          logoutBtn.innerHTML = `<i class="fas fa-sign-out-alt"></i> <span>${translations[currentLang].logoutBtn}</span>`;
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÜÿµ
        document.documentElement.setAttribute("lang", currentLang);
        document.body.setAttribute("dir", currentLang === "ar" ? "rtl" : "ltr");
        
        // ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÅÿ™ÿßÿ≠ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©
        const langSwitch = await waitForElement("langSwitch", 1000);
        if (langSwitch) {
          langSwitch.innerHTML = `<i class="fas fa-language"></i> ${currentLang.toUpperCase()}`;
        }
      }

      // ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÑÿ∫ÿ©
      function toggleLanguage() {
        currentLang = currentLang === "en" ? "ar" : "en";
        localStorage.setItem("portalLang", currentLang);
        initLanguage();
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿ∏ÿßŸáÿ±ÿ©
        updateWarnings();
      }

      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÑÿ∫ÿ©
      function updateWarnings() {
        if (isDemoMode) {
          const demoModeWarning = byId("demoModeWarning");
          if (demoModeWarning) {
            demoModeWarning.innerHTML = `<strong>${translations[currentLang].configNotice}</strong> ${translations[currentLang].demoModeNotice}`;
            demoModeWarning.classList.remove("hidden");
          }
          
          // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
          const loginAlert = byId("loginAlert");
          if (loginAlert) {
            loginAlert.textContent = translations[currentLang].demoModeLoginMessage;
            loginAlert.className = "alert alert-success";
            loginAlert.classList.remove("hidden");
            
            setTimeout(() => {
              if (loginAlert) loginAlert.classList.add("hidden");
            }, 5000);
          }
        }
      }

      // ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä
      const demoProjectData = {
        customerName: "Demo Customer",
        projectId: "DEMO123",
        projectName: "Example Project",
        deploymentDate: "Jan 15, 2023",
        supportEndDate: "Dec 31, 2025",
        supportStatus: "Active",
        projectStatus: "Live",
        url: "https://example.com"
      };

      // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
      async function handleLogin(e) {
        e.preventDefault();
        
        // ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
        const [projectUrlEl, projectIdEl, loginBtn, loginBtnText, loginSpinner, loginAlert] = await Promise.all([
          waitForElement('projectUrl', 2000),
          waitForElement('projectId', 2000),
          waitForElement('loginBtn', 2000),
          waitForElement('loginBtnText', 2000),
          waitForElement('loginSpinner', 2000),
          waitForElement('loginAlert', 2000)
        ]);
        
        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ±
        if (!projectUrlEl || !projectIdEl || !loginBtn || !loginBtnText || !loginSpinner || !loginAlert) {
          console.error("‚ùå Critical elements missing for login");
          
          if (loginAlert) {
            loginAlert.textContent = translations[currentLang].systemError;
            loginAlert.className = "alert alert-error";
            loginAlert.classList.remove("hidden");
          }
          
          // ÿ•ÿπÿßÿØÿ© ÿ™ŸÖŸÉŸäŸÜ ÿßŸÑÿ≤ÿ± Ÿàÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖÿ§ÿ¥ÿ± ÿßŸÑÿØŸàÿßÿ±
          if (loginBtn) loginBtn.disabled = false;
          if (loginBtnText) loginBtnText.classList.remove("hidden");
          if (loginSpinner) loginSpinner.classList.add("hidden");
          
          return;
        }

        const projectUrl = projectUrlEl.value.trim();
        const projectId = projectIdEl.value.trim().toUpperCase();

        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™
        if (!projectUrl || !projectId) {
          loginAlert.textContent = translations[currentLang].loginError;
          loginAlert.className = "alert alert-error";
          loginAlert.classList.remove("hidden");
          return;
        }

        // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        loginAlert.classList.add("hidden");
        loginBtn.disabled = true;
        loginBtnText.classList.add("hidden");
        loginSpinner.classList.remove("hidden");

        try {
          if (isDemoMode) {
            console.log("üîÑ Processing demo login");
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä
            if (projectUrl === "https://example.com" && projectId === "DEMO123") {
              setTimeout(() => {
                loginAlert.textContent = translations[currentLang].loginSuccess;
                loginAlert.className = "alert alert-success";
                loginAlert.classList.remove("hidden");
                
                setTimeout(() => {
                  saveSession(demoProjectData);
                  showPortal(demoProjectData);
                }, 1000);
              }, 500);
            } else {
              throw new Error(translations[currentLang].loginError);
            }
            return;
          }

          // Ÿàÿ∂ÿπ Firebase ÿßŸÑÿ≠ŸÇŸäŸÇŸä
          if (!isFirebaseReady) {
            const initSuccess = initFirebase();
            if (!initSuccess) {
              throw new Error(translations[currentLang].firebaseError);
            }
          }

          if (!db) {
            throw new Error(translations[currentLang].firebaseError);
          }

          // ÿ™Ÿàÿ≠ŸäÿØ ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ©
          const normalizeUrl = (url) => {
            return url
              .replace(/^(https?:\/\/)?(www\.)?/, "")
              .replace(/\/$/, "")
              .toLowerCase();
          };

          const normalizedInputUrl = normalizeUrl(projectUrl);

          // ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ Firestore
          const projectsRef = db.collection("projects");
          const snapshot = await projectsRef
            .where(firebase.firestore.FieldPath.documentId(), "==", projectId)
            .where("url", "==", normalizedInputUrl)
            .limit(1)
            .get();

          if (snapshot.empty) {
            throw new Error(translations[currentLang].loginError);
          }

          const doc = snapshot.docs[0];
          const data = doc.data();
          data.projectId = projectId;

          // ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ
          if (data.deploymentDate && data.deploymentDate.toDate) {
            data.deploymentDate = formatDate(data.deploymentDate.toDate());
          } else if (typeof data.deploymentDate === "string") {
            const date = new Date(data.deploymentDate);
            if (!isNaN(date.getTime())) {
              data.deploymentDate = formatDate(date);
            }
          }

          if (data.supportEndDate && data.supportEndDate.toDate) {
            data.supportEndDate = formatDate(data.supportEndDate.toDate());
          } else if (typeof data.supportEndDate === "string") {
            const date = new Date(data.supportEndDate);
            if (!isNaN(date.getTime())) {
              data.supportEndDate = formatDate(date);
            }
          }

          // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠
          loginAlert.textContent = translations[currentLang].loginSuccess;
          loginAlert.className = "alert alert-success";
          loginAlert.classList.remove("hidden");

          // ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
          setTimeout(() => {
            saveSession(data);
            showPortal(data);
          }, 1000);
        } catch (error) {
          console.error("Login error:", error);
          const errorMessage = error.message || translations[currentLang].loginError;
          loginAlert.textContent = errorMessage;
          loginAlert.className = "alert alert-error";
          loginAlert.classList.remove("hidden");
        } finally {
          loginBtn.disabled = false;
          loginBtnText.classList.remove("hidden");
          loginSpinner.classList.add("hidden");
        }
      }

      // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
      async function handleLogout() {
        localStorage.removeItem("portalSession");
        
        const [loginPage, portalPage, loginForm, loginAlert] = await Promise.all([
          waitForElement("loginPage", 1000),
          waitForElement("portalPage", 1000),
          waitForElement("loginForm", 1000),
          waitForElement("loginAlert", 1000)
        ]);

        if (loginForm) loginForm.reset();
        if (portalPage) portalPage.classList.add("hidden");
        if (loginPage) loginPage.classList.remove("hidden");

        // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ÿßÿ≠
        if (loginAlert) {
          loginAlert.textContent = translations[currentLang].logoutSuccess;
          loginAlert.className = "alert alert-success";
          loginAlert.classList.remove("hidden");

          setTimeout(() => {
            if (loginAlert) loginAlert.classList.add("hidden");
          }, 3000);
        }
      }

      // ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
      async function showPortal(data) {
        // ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©
        const [
          customerNameDisplay, customerNameEl, projectIdDisplay, projectNameEl,
          deploymentDateEl, supportEndDateEl, supportStatusEl, projectStatusEl,
          projectUrlLink, loginPage, portalPage
        ] = await Promise.all([
          waitForElement("customerNameDisplay", 1500),
          waitForElement("customerName", 1500),
          waitForElement("projectIdDisplay", 1500),
          waitForElement("projectName", 1500),
          waitForElement("deploymentDate", 1500),
          waitForElement("supportEndDate", 1500),
          waitForElement("supportStatus", 1500),
          waitForElement("projectStatus", 1500),
          waitForElement("projectUrlLink", 1500),
          waitForElement("loginPage", 1500),
          waitForElement("portalPage", 1500)
        ]);
        
        // ŸÖŸÑÿ° ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        if (customerNameDisplay) customerNameDisplay.textContent = data.customerName || "Unknown Customer";
        if (customerNameEl) customerNameEl.textContent = data.customerName || "N/A";
        if (projectIdDisplay) projectIdDisplay.textContent = data.projectId || "N/A";
        if (projectNameEl) projectNameEl.textContent = data.projectName || "N/A";
        if (deploymentDateEl) deploymentDateEl.textContent = data.deploymentDate || "N/A";
        if (supportEndDateEl) supportEndDateEl.textContent = data.supportEndDate || "N/A";
        
        // ÿ≠ÿßŸÑÿ© ÿßŸÑÿØÿπŸÖ
        if (supportStatusEl) {
          supportStatusEl.textContent = data.supportStatus || "Unknown";
          supportStatusEl.className = "status-badge";
          
          if (["Active", "ŸÜÿ¥ÿ∑"].includes(data.supportStatus)) {
            supportStatusEl.classList.add("status-active");
          } else if (["Expired", "ŸÖŸÜÿ™ŸáŸä"].includes(data.supportStatus)) {
            supportStatusEl.classList.add("status-expired");
          } else {
            supportStatusEl.classList.add("status-maintenance");
          }
        }
        
        // ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
        if (projectStatusEl) {
          projectStatusEl.textContent = data.projectStatus || "Unknown";
          projectStatusEl.className = "status-badge";
          
          if (["Live", "ŸÜÿ¥ÿ∑"].includes(data.projectStatus)) {
            projectStatusEl.classList.add("status-active");
          } else if (["Maintenance", "ÿµŸäÿßŸÜÿ©"].includes(data.projectStatus)) {
            projectStatusEl.classList.add("status-maintenance");
          } else {
            projectStatusEl.classList.add("status-expired");
          }
        }
        
        // ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
        const projectUrl = data.projectUrl || data.url || "#";
        if (projectUrlLink) {
          projectUrlLink.textContent = projectUrl !== "#" ? projectUrl : "N/A";
          projectUrlLink.href = projectUrl !== "#" ? projectUrl : "#";
        }

        // ÿπÿ±ÿ∂ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ Ÿàÿ•ÿÆŸÅÿßÿ° ÿµŸÅÿ≠ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        if (loginPage) loginPage.classList.add("hidden");
        if (portalPage) portalPage.classList.remove("hidden");
      }

      // ÿ≠ŸÅÿ∏ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
      function saveSession(data) {
        const sessionData = {
          customerName: data.customerName || "Unknown Customer",
          projectId: data.projectId || "Unknown",
          projectName: data.projectName || "Unknown Project",
          deploymentDate: data.deploymentDate || "N/A",
          supportEndDate: data.supportEndDate || "N/A",
          supportStatus: data.supportStatus || "Unknown",
          projectStatus: data.projectStatus || "Unknown",
          projectUrl: data.projectUrl || data.url || "#",
        };

        localStorage.setItem("portalSession", JSON.stringify(sessionData));
      }

      // ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
      function formatDate(date) {
        return new Date(date).toLocaleDateString(
          currentLang === "ar" ? "ar-EG" : "en-US",
          {
            year: "numeric",
            month: "short",
            day: "numeric",
          }
        );
      }

      // ŸÅÿ≠ÿµ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
      async function checkExistingSession() {
        const savedSession = localStorage.getItem("portalSession");
        if (savedSession) {
          try {
            showPortal(JSON.parse(savedSession));
          } catch (e) {
            console.error("Error parsing saved session:", e);
            localStorage.removeItem("portalSession");
          }
        }
      }

      // ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ŸÖÿπŸÑŸÖÿßÿ™ URL
      function getUrlParams() {
        try {
          const params = new URLSearchParams(window.location.search);
          return {
            url: params.get('url'),
            id: params.get('id')
          };
        } catch (error) {
          console.warn("Error parsing URL parameters:", error);
          return { url: null, id: null };
        }
      }

      // ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ŸÖÿπŸÑŸÖÿßÿ™ URL
      async function autoFillFromUrlParams() {
        const params = getUrlParams();
        if (!params.url && !params.id) return;
        
        const [projectUrlEl, projectIdEl] = await Promise.all([
          waitForElement('projectUrl', 1500),
          waitForElement('projectId', 1500)
        ]);
        
        if (projectUrlEl && params.url) {
          projectUrlEl.value = params.url;
        }
        
        if (projectIdEl && params.id) {
          projectIdEl.value = params.id;
        }
        
        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÅŸä Ÿàÿ∂ÿπ ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ¨ÿ±Ÿäÿ®Ÿä
        if (isDemoMode && params.url && params.id) {
          setTimeout(() => {
            const loginForm = byId('loginForm');
            if (loginForm && projectUrlEl.value && projectIdEl.value) {
              loginForm.requestSubmit();
            }
          }, 600);
        }
      }

      // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
      async function initApp() {
        if (appInitialized) return;
        appInitialized = true;
        
        console.log("üöÄ Initializing Project Portal...");
        
        // ŸÉÿ¥ŸÅ ÿßŸÑÿ®Ÿäÿ¶ÿ©
        detectEnvironment();
        
        // ÿ™ŸáŸäÿ¶ÿ© Firebase ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ±
        if (!isDemoMode) {
          initFirebase();
        }
        
        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÑÿ∫ÿ©
        await initLanguage();
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™
        updateWarnings();
        
        // ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        const [langSwitch, loginForm, logoutBtn] = await Promise.all([
          waitForElement("langSwitch", 1500),
          waitForElement("loginForm", 1500),
          waitForElement("logoutBtn", 1500)
        ]);
        
        if (langSwitch) {
          langSwitch.addEventListener("click", toggleLanguage);
        }
        
        if (loginForm) {
          loginForm.addEventListener("submit", handleLogin);
        }
        
        if (logoutBtn) {
          logoutBtn.addEventListener("click", handleLogout);
        }
        
        // ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖŸÜ ŸÖÿπŸÑŸÖÿßÿ™ URL
        await autoFillFromUrlParams();
        
        // ŸÅÿ≠ÿµ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
        await checkExistingSession();
        
        console.log(isDemoMode ? "‚úÖ Application initialized in DEMO MODE" : "‚úÖ Application initialized in REAL MODE");
      }

      // ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ DOM
      document.addEventListener('DOMContentLoaded', () => {
        console.log("üìÑ DOM fully loaded. Starting application...");
        initApp();
      });

      // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿπÿßŸÑŸÖŸäÿ©
      window.onerror = function(message, source, lineno, colno, error) {
        console.error("‚ùå Global error caught:", { message, source, lineno, colno, error });
        return true;
      };

      window.addEventListener('unhandledrejection', function(event) {
        console.error("‚ùå Unhandled promise rejection:", event.reason);
        event.preventDefault();
      });
    </script>
  </body>
</html>
