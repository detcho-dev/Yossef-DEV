<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <!-- Firebase SDKs loaded FIRST in head section -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
      :root {
        --primary: #4361ee;
        --secondary: #3f37c9;
        --success: #4cc9f0;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #6c757d;
        --border-radius: 12px;
        --box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--dark);
        background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        transition: var(--transition);
      }

      body[dir="rtl"] {
        font-family: "Tajawal", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .container {
        width: 100%;
        max-width: 1000px;
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        overflow: hidden;
        transition: var(--transition);
      }

      .card-header {
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        color: white;
        padding: 20px 30px;
        text-align: center;
      }

      .card-body {
        padding: 30px;
      }

      .logo {
        font-size: 2.2rem;
        margin-bottom: 15px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .card-title {
        font-size: 1.8rem;
        font-weight: 600;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--dark);
      }

      input,
      select {
        width: 100%;
        padding: 14px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      }

      .btn {
        display: inline-block;
        background: var(--primary);
        color: white;
        border: none;
        padding: 14px 25px;
        font-size: 1rem;
        font-weight: 500;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        text-align: center;
        text-decoration: none;
      }

      .btn:hover {
        background: var(--secondary);
        transform: translateY(-2px);
      }

      .btn-block {
        display: block;
        width: 100%;
      }

      .btn-outline {
        background: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
      }

      .btn-outline:hover {
        background: var(--primary);
        color: white;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 500;
      }

      .alert-error {
        background: rgba(239, 68, 68, 0.15);
        color: #ef4444;
        border: 1px solid #ef4444;
      }

      .alert-success {
        background: rgba(34, 197, 94, 0.15);
        color: #22c55e;
        border: 1px solid #22c55e;
      }

      .project-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .project-item {
        background: #f8fafc;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
        border-left: 4px solid var(--primary);
      }

      .project-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      .project-label {
        font-weight: 500;
        color: var(--gray);
        font-size: 0.9rem;
        margin-bottom: 5px;
        display: block;
      }

      .project-value {
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--dark);
      }

      .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .status-active {
        background: rgba(34, 197, 94, 0.2);
        color: #16a34a;
      }

      .status-expired {
        background: rgba(239, 68, 68, 0.2);
        color: #dc2626;
      }

      .status-maintenance {
        background: rgba(245, 158, 11, 0.2);
        color: #d97706;
      }

      .project-url {
        color: var(--primary);
        text-decoration: none;
        word-break: break-all;
        display: block;
        margin-top: 5px;
        transition: var(--transition);
      }

      .project-url:hover {
        color: var(--secondary);
        text-decoration: underline;
      }

      .lang-switch {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: white;
        border: 1px solid #ddd;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
      }

      .lang-switch:hover {
        transform: rotate(30deg);
      }

      .lang-switch i {
        font-size: 1.2rem;
        color: var(--primary);
      }

      .hidden {
        display: none;
      }

      footer {
        text-align: center;
        margin-top: 20px;
        color: var(--gray);
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        .card-body {
          padding: 20px;
        }

        .card-header {
          padding: 15px 20px;
        }

        .logo {
          font-size: 1.8rem;
        }

        .card-title {
          font-size: 1.5rem;
        }

        .project-grid {
          grid-template-columns: 1fr;
        }

        .lang-switch {
          top: 15px;
          right: 15px;
          width: 45px;
          height: 45px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 10px;
        }

        .container {
          margin: 10px auto;
        }

        .card-body {
          padding: 15px;
        }

        .form-group {
          margin-bottom: 15px;
        }

        input,
        select,
        .btn {
          padding: 12px;
        }
      }

      [dir="rtl"] {
        text-align: right;
        direction: rtl;
      }

      [dir="rtl"] .logo i {
        margin-left: 10px;
        margin-right: 0;
      }

      [dir="rtl"] .lang-switch {
        right: auto;
        left: 20px;
      }

      [dir="rtl"] .project-item {
        border-left: none;
        border-right: 4px solid var(--primary);
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(67, 97, 238, 0.2);
        border-top: 5px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .config-warning {
        background-color: #fff8e1;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        font-size: 0.95rem;
      }

      .no-firebase-warning {
        background-color: #ffebee;
        border-left: 4px solid #f44336;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        font-size: 0.95rem;
      }
      
      .demo-mode-warning {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
        font-size: 0.95rem;
      }
      
      /* Ù†Ù…Ø· Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© */
      .critical-warning {
        background-color: #ffecb3;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 12px;
        margin: 15px 0;
        font-weight: 500;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="lang-switch" id="langSwitch">
      <i class="fas fa-language"></i>
    </div>

    <div class="container">
      <div id="loginPage" class="card">
        <div class="card-header">
          <div class="logo">
            <i class="fas fa-shield-alt"></i>
            <div class="card-title" data-i18n="loginTitle">
              Project Portal Login
            </div>
          </div>
        </div>
        <div class="card-body">
          <div id="loginAlert" class="alert hidden" role="alert"></div>

          <div class="config-warning hidden" id="configWarning">
            <strong>Configuration Required:</strong> Firebase is not configured.
            Replace the firebaseConfig object in the script with your Firebase
            project details.
          </div>

          <div class="no-firebase-warning hidden" id="noFirebaseWarning">
            <strong>Connection Issue:</strong> Unable to connect to Firebase. 
            Please ensure you're running this from a proper web server and not directly from a file.
          </div>
          
          <div class="demo-mode-warning hidden" id="demoModeWarning">
            <strong>Demo Mode:</strong> Running in demo mode. For real functionality, deploy to a web server with proper Firebase configuration.
          </div>

          <form id="loginForm">
            <div class="form-group">
              <label for="projectUrl" data-i18n="urlField">Project URL</label>
              <input
                type="url"
                id="projectUrl"
                placeholder="https://example.com"
                required
              />
            </div>

            <div class="form-group">
              <label for="projectId" data-i18n="idField">Project ID</label>
              <input
                type="text"
                id="projectId"
                placeholder="PROJ-123"
                required
              />
            </div>

            <button
              type="submit"
              class="btn btn-block"
              id="loginBtn"
              data-i18n="loginBtn"
            >
              <span id="loginBtnText">Login to Portal</span>
              <span id="loginSpinner" class="spinner hidden"></span>
            </button>
          </form>
        </div>
      </div>

      <div id="portalPage" class="card hidden">
        <div class="card-header">
          <div class="logo">
            <i class="fas fa-tachometer-alt"></i>
            <div class="card-title" data-i18n="portalTitle">
              Project Dashboard
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="alert alert-success" id="welcomeMessage">
            <span data-i18n="welcomeMessage">Welcome back,</span>
            <strong id="customerNameDisplay"></strong>!
          </div>

          <div id="portalContent">
            <div class="loading hidden">
              <div class="spinner"></div>
            </div>

            <div class="project-grid">
              <div class="project-item">
                <span class="project-label" data-i18n="customerName"
                  >Customer Name</span
                >
                <span class="project-value" id="customerName"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectId"
                  >Project ID</span
                >
                <span class="project-value" id="projectIdDisplay"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectName"
                  >Project Name</span
                >
                <span class="project-value" id="projectName"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="deploymentDate"
                  >Deployment Date</span
                >
                <span class="project-value" id="deploymentDate"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="supportEndDate"
                  >Support End Date</span
                >
                <span class="project-value" id="supportEndDate"></span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="supportStatus"
                  >Support Status</span
                >
                <span class="project-value">
                  <span id="supportStatus" class="status-badge"></span>
                </span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectStatus"
                  >Project Status</span
                >
                <span class="project-value">
                  <span id="projectStatus" class="status-badge"></span>
                </span>
              </div>

              <div class="project-item">
                <span class="project-label" data-i18n="projectUrl"
                  >Project URL</span
                >
                <a
                  href="#"
                  id="projectUrlLink"
                  class="project-url"
                  target="_blank"
                ></a>
              </div>
            </div>
          </div>

          <div style="margin-top: 30px; text-align: center">
            <button
              class="btn btn-outline"
              id="logoutBtn"
              data-i18n="logoutBtn"
            >
              <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p data-i18n="footerText">
        Project Portal System &copy; 2025 | Secure Cloud Management
      </p>
    </footer>

    <script>
      // âš ï¸ IMPORTANT: REPLACE WITH YOUR ACTUAL FIREBASE CONFIG âš ï¸
      const firebaseConfig = {
        apiKey: "AIzaSyAemoGMX1PHF55qUTh_5SZIrN3Y-QaqrWA",
        authDomain: "yossef-dev-216b0.firebaseapp.com",
        projectId: "yossef-dev-216b0",
        storageBucket: "yossef-dev-216b0.firebasestorage.app",
        messagingSenderId: "509948939620",
        appId: "1:509948939620:web:017b806e995bb114d8be71",
      };

      let db = null;
      let isFirebaseReady = false;
      let isDemoMode = false;
      let appInitialized = false;
      let currentLang = "en";

      // Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª
      const translations = {
        en: {
          loginTitle: "Project Portal Login",
          urlField: "Project URL",
          idField: "Project ID",
          loginBtn: "Login to Portal",
          portalTitle: "Project Dashboard",
          welcomeMessage: "Welcome back,",
          customerName: "Customer Name",
          projectId: "Project ID",
          projectName: "Project Name",
          deploymentDate: "Deployment Date",
          supportEndDate: "Support End Date",
          supportStatus: "Support Status",
          projectStatus: "Project Status",
          projectUrl: "Project URL",
          logoutBtn: "Logout",
          footerText: "Project Portal System &copy; 2025 | Secure Cloud Management",
          loginError: "Invalid URL or Project ID. Please try again.",
          loginSuccess: "Login successful! Redirecting to portal...",
          logoutSuccess: "You have been successfully logged out.",
          configNotice: "Configuration Required:",
          configMessage: "Firebase is not configured. Replace the firebaseConfig object in the script with your Firebase project details.",
          systemError: "System error: Please contact administrator.",
          firebaseError: "Firebase initialization failed. Please check configuration.",
          demoModeLoginMessage: "Demo mode: Use URL: https://example.com and Project ID: DEMO123",
          demoModeNotice: "Running in demo mode. Real Firebase functionality requires proper deployment.",
          environmentWarning: "This page is running in a limited environment. For full functionality, deploy to a web server."
        },
        ar: {
          loginTitle: "ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          urlField: "Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          idField: "Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          loginBtn: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¨ÙˆØ§Ø¨Ø©",
          portalTitle: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          welcomeMessage: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒØŒ",
          customerName: "Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„",
          projectId: "Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          projectName: "Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          deploymentDate: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±",
          supportEndDate: "ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¯Ø¹Ù…",
          supportStatus: "Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø¹Ù…",
          projectStatus: "Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          projectUrl: "Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
          logoutBtn: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",
          footerText: "Ù†Ø¸Ø§Ù… Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ &copy; 2025 | Ø¥Ø¯Ø§Ø±Ø© Ø³Ø­Ø§Ø¨ÙŠØ© Ø¢Ù…Ù†Ø©",
          loginError: "Ø±Ø§Ø¨Ø· Ø£Ùˆ Ù…Ø¹Ø±Ù Ù…Ø´Ø±ÙˆØ¹ ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
          loginSuccess: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©...",
          logoutSuccess: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­.",
          configNotice: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©:",
          configMessage: "Firebase ØºÙŠØ± Ù…Ø¶Ø¨ÙˆØ·. Ø§Ø³ØªØ¨Ø¯Ù„ ÙƒØ§Ø¦Ù† firebaseConfig ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù†ØµÙŠ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹ Firebase Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.",
          systemError: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…: ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.",
          firebaseError: "ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Firebase. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ‡ÙŠØ¦Ø©.",
          demoModeLoginMessage: "ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø·: https://example.com ÙˆÙ…Ø¹Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: DEMO123",
          demoModeNotice: "ÙŠØ¹Ù…Ù„ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ. ÙˆØ¸Ø§Ø¦Ù Firebase Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªØªØ·Ù„Ø¨ Ù†Ø´Ø±Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§.",
          environmentWarning: "Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ¹Ù…Ù„ ÙÙŠ Ø¨ÙŠØ¦Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©. Ù„Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙƒØ§Ù…Ù„Ø©ØŒ Ø§Ù†Ø´Ø±Ù‡Ø§ Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… ÙˆÙŠØ¨."
        },
      };

      // Ø¯Ø§Ù„Ø© Ø¢Ù…Ù†Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ±
      function byId(id) {
        return document.getElementById(id);
      }

      // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø¹Ù†ØµØ± Ù…Ø¹ÙŠÙ†
      function waitForElement(id, timeout = 5000) {
        return new Promise((resolve) => {
          const element = byId(id);
          if (element) {
            resolve(element);
            return;
          }
          
          const startTime = Date.now();
          const checkInterval = setInterval(() => {
            const element = byId(id);
            if (element) {
              clearInterval(checkInterval);
              resolve(element);
            } else if (Date.now() - startTime > timeout) {
              clearInterval(checkInterval);
              resolve(null);
            }
          }, 100);
        });
      }

      // ÙƒØ´Ù Ø§Ù„Ø¨ÙŠØ¦Ø©
      function detectEnvironment() {
        const isFileProtocol = window.location.protocol === 'file:';
        const isVSCodeWebView = window.location.href.includes('vscode-webview') || 
                               window.location.href.includes('vscode-extension');
        const isLocalhost = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
        
        if (isFileProtocol || isVSCodeWebView) {
          isDemoMode = true;
          console.log("âœ… Running in DEMO MODE (environment limitation)");
          return;
        }
        
        try {
          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙƒÙˆÙŠÙ† Firebase
          if (!firebaseConfig.apiKey || 
              firebaseConfig.apiKey.trim() === "" || 
              firebaseConfig.apiKey === "AIzaSyAemoGMX1PHF55qUTh_5SZIrN3Y-QaqrWA") {
            isDemoMode = true;
            console.log("âœ… Running in DEMO MODE (default Firebase config)");
            return;
          }
          
          isDemoMode = false;
          console.log("âœ… Running in REAL MODE (Firebase enabled)");
        } catch (e) {
          isDemoMode = true;
          console.log("âœ… Running in DEMO MODE (Firebase error)");
        }
      }

      // ØªÙ‡ÙŠØ¦Ø© Firebase
      function initFirebase() {
        if (isDemoMode) {
          console.log("â„¹ï¸ Skipping Firebase initialization in demo mode");
          return;
        }
        
        try {
          if (typeof firebase === 'undefined') {
            throw new Error("Firebase SDK not loaded");
          }
          
          firebase.initializeApp(firebaseConfig);
          db = firebase.firestore();
          isFirebaseReady = true;
          console.log("âœ… Firebase initialized successfully");
          return true;
        } catch (error) {
          console.error("âŒ Firebase initialization failed:", error);
          
          // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ø°ÙŠØ±Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø©
          const configWarning = byId("configWarning");
          const noFirebaseWarning = byId("noFirebaseWarning");
          
          if (configWarning) configWarning.classList.remove("hidden");
          if (noFirebaseWarning) noFirebaseWarning.classList.remove("hidden");
          
          isDemoMode = true;
          return false;
        }
      }

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ØºØ©
      async function initLanguage() {
        currentLang = localStorage.getItem("portalLang") || "en";
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ±Ø¬Ù…Ø©
        document.querySelectorAll("[data-i18n]").forEach(element => {
          const key = element.getAttribute("data-i18n");
          if (translations[currentLang][key]) {
            element.textContent = translations[currentLang][key];
          }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ØºØ©
        const loginBtnText = await waitForElement("loginBtnText", 1000);
        if (loginBtnText) {
          loginBtnText.textContent = translations[currentLang].loginBtn;
        }
        
        const logoutBtn = await waitForElement("logoutBtn", 1000);
        if (logoutBtn) {
          logoutBtn.innerHTML = `<i class="fas fa-sign-out-alt"></i> <span>${translations[currentLang].logoutBtn}</span>`;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ
        document.documentElement.setAttribute("lang", currentLang);
        document.body.setAttribute("dir", currentLang === "ar" ? "rtl" : "ltr");
        
        // ØªØ­Ø¯ÙŠØ« Ù…ÙØªØ§Ø­ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
        const langSwitch = await waitForElement("langSwitch", 1000);
        if (langSwitch) {
          langSwitch.innerHTML = `<i class="fas fa-language"></i> ${currentLang.toUpperCase()}`;
        }
      }

      // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
      function toggleLanguage() {
        currentLang = currentLang === "en" ? "ar" : "en";
        localStorage.setItem("portalLang", currentLang);
        initLanguage();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¸Ø§Ù‡Ø±Ø©
        updateWarnings();
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„ØºØ©
      function updateWarnings() {
        if (isDemoMode) {
          const demoModeWarning = byId("demoModeWarning");
          if (demoModeWarning) {
            demoModeWarning.innerHTML = `<strong>${translations[currentLang].configNotice}</strong> ${translations[currentLang].demoModeNotice}`;
            demoModeWarning.classList.remove("hidden");
          }
          
          // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
          const loginAlert = byId("loginAlert");
          if (loginAlert) {
            loginAlert.textContent = translations[currentLang].demoModeLoginMessage;
            loginAlert.className = "alert alert-success";
            loginAlert.classList.remove("hidden");
            
            setTimeout(() => {
              if (loginAlert) loginAlert.classList.add("hidden");
            }, 5000);
          }
        }
      }

      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
      const demoProjectData = {
        customerName: "Demo Customer",
        projectId: "DEMO123",
        projectName: "Example Project",
        deploymentDate: "Jan 15, 2023",
        supportEndDate: "Dec 31, 2025",
        supportStatus: "Active",
        projectStatus: "Live",
        url: "https://example.com"
      };

      // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      async function handleLogin(e) {
        e.preventDefault();

        if (!document.getElementById('projectUrl') || !document.getElementById('projectId')) {
          console.error("âŒ Login elements not ready yet");
          alert("Page not fully loaded. Please wait and try again.");
          return;
        }
        
        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        const [projectUrlEl, projectIdEl, loginBtn, loginBtnText, loginSpinner, loginAlert] = await Promise.all([
          waitForElement('projectUrl', 2000),
          waitForElement('projectId', 2000),
          waitForElement('loginBtn', 2000),
          waitForElement('loginBtnText', 2000),
          waitForElement('loginSpinner', 2000),
          waitForElement('loginAlert', 2000)
        ]);
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
        if (!projectUrlEl || !projectIdEl || !loginBtn || !loginBtnText || !loginSpinner || !loginAlert) {
          console.error("âŒ Critical elements missing for login");
          
          if (loginAlert) {
            loginAlert.textContent = translations[currentLang].systemError;
            loginAlert.className = "alert alert-error";
            loginAlert.classList.remove("hidden");
          }
          
          // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ø¯ÙˆØ§Ø±
          if (loginBtn) loginBtn.disabled = false;
          if (loginBtnText) loginBtnText.classList.remove("hidden");
          if (loginSpinner) loginSpinner.classList.add("hidden");
          
          return;
        }

        const projectUrl = projectUrlEl.value.trim();
        const projectId = projectIdEl.value.trim().toUpperCase();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        if (!projectUrl || !projectId) {
          loginAlert.textContent = translations[currentLang].loginError;
          loginAlert.className = "alert alert-error";
          loginAlert.classList.remove("hidden");
          return;
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        loginAlert.classList.add("hidden");
        loginBtn.disabled = true;
        loginBtnText.classList.add("hidden");
        loginSpinner.classList.remove("hidden");

        try {
          if (isDemoMode) {
            console.log("ğŸ”„ Processing demo login");
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
            if (projectUrl === "https://example.com" && projectId === "DEMO123") {
              setTimeout(() => {
                loginAlert.textContent = translations[currentLang].loginSuccess;
                loginAlert.className = "alert alert-success";
                loginAlert.classList.remove("hidden");
                
                setTimeout(() => {
                  saveSession(demoProjectData);
                  showPortal(demoProjectData);
                }, 1000);
              }, 500);
            } else {
              throw new Error(translations[currentLang].loginError);
            }
            return;
          }

          // ÙˆØ¶Ø¹ Firebase Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
          if (!isFirebaseReady) {
            const initSuccess = initFirebase();
            if (!initSuccess) {
              throw new Error(translations[currentLang].firebaseError);
            }
          }

          if (!db) {
            throw new Error(translations[currentLang].firebaseError);
          }

          // ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
          const normalizeUrl = (url) => {
            return url
              .replace(/^(https?:\/\/)?(www\.)?/, "")
              .replace(/\/$/, "")
              .toLowerCase();
          };

          const normalizedInputUrl = normalizeUrl(projectUrl);

          // Ø§Ø³ØªØ¹Ù„Ø§Ù… Firestore
          const projectsRef = db.collection("projects");
          const snapshot = await projectsRef
            .where(firebase.firestore.FieldPath.documentId(), "==", projectId)
            .where("url", "==", normalizedInputUrl)
            .limit(1)
            .get();

          if (snapshot.empty) {
            throw new Error(translations[currentLang].loginError);
          }

          const doc = snapshot.docs[0];
          const data = doc.data();
          data.projectId = projectId;

          // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
          if (data.deploymentDate && data.deploymentDate.toDate) {
            data.deploymentDate = formatDate(data.deploymentDate.toDate());
          } else if (typeof data.deploymentDate === "string") {
            const date = new Date(data.deploymentDate);
            if (!isNaN(date.getTime())) {
              data.deploymentDate = formatDate(date);
            }
          }

          if (data.supportEndDate && data.supportEndDate.toDate) {
            data.supportEndDate = formatDate(data.supportEndDate.toDate());
          } else if (typeof data.supportEndDate === "string") {
            const date = new Date(data.supportEndDate);
            if (!isNaN(date.getTime())) {
              data.supportEndDate = formatDate(date);
            }
          }

          // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
          loginAlert.textContent = translations[currentLang].loginSuccess;
          loginAlert.className = "alert alert-success";
          loginAlert.classList.remove("hidden");

          // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
          setTimeout(() => {
            saveSession(data);
            showPortal(data);
          }, 1000);
        } catch (error) {
          console.error("Login error:", error);
          const errorMessage = error.message || translations[currentLang].loginError;
          loginAlert.textContent = errorMessage;
          loginAlert.className = "alert alert-error";
          loginAlert.classList.remove("hidden");
        } finally {
          loginBtn.disabled = false;
          loginBtnText.classList.remove("hidden");
          loginSpinner.classList.add("hidden");
        }
      }

      // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
      async function handleLogout() {
        localStorage.removeItem("portalSession");
        
        const [loginPage, portalPage, loginForm, loginAlert] = await Promise.all([
          waitForElement("loginPage", 1000),
          waitForElement("portalPage", 1000),
          waitForElement("loginForm", 1000),
          waitForElement("loginAlert", 1000)
        ]);

        if (loginForm) loginForm.reset();
        if (portalPage) portalPage.classList.add("hidden");
        if (loginPage) loginPage.classList.remove("hidden");

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        if (loginAlert) {
          loginAlert.textContent = translations[currentLang].logoutSuccess;
          loginAlert.className = "alert alert-success";
          loginAlert.classList.remove("hidden");

          setTimeout(() => {
            if (loginAlert) loginAlert.classList.add("hidden");
          }, 3000);
        }
      }

      // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
      async function showPortal(data) {
        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        const [
          customerNameDisplay, customerNameEl, projectIdDisplay, projectNameEl,
          deploymentDateEl, supportEndDateEl, supportStatusEl, projectStatusEl,
          projectUrlLink, loginPage, portalPage
        ] = await Promise.all([
          waitForElement("customerNameDisplay", 1500),
          waitForElement("customerName", 1500),
          waitForElement("projectIdDisplay", 1500),
          waitForElement("projectName", 1500),
          waitForElement("deploymentDate", 1500),
          waitForElement("supportEndDate", 1500),
          waitForElement("supportStatus", 1500),
          waitForElement("projectStatus", 1500),
          waitForElement("projectUrlLink", 1500),
          waitForElement("loginPage", 1500),
          waitForElement("portalPage", 1500)
        ]);
        
        // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (customerNameDisplay) customerNameDisplay.textContent = data.customerName || "Unknown Customer";
        if (customerNameEl) customerNameEl.textContent = data.customerName || "N/A";
        if (projectIdDisplay) projectIdDisplay.textContent = data.projectId || "N/A";
        if (projectNameEl) projectNameEl.textContent = data.projectName || "N/A";
        if (deploymentDateEl) deploymentDateEl.textContent = data.deploymentDate || "N/A";
        if (supportEndDateEl) supportEndDateEl.textContent = data.supportEndDate || "N/A";
        
        // Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø¹Ù…
        if (supportStatusEl) {
          supportStatusEl.textContent = data.supportStatus || "Unknown";
          supportStatusEl.className = "status-badge";
          
          if (["Active", "Ù†Ø´Ø·"].includes(data.supportStatus)) {
            supportStatusEl.classList.add("status-active");
          } else if (["Expired", "Ù…Ù†ØªÙ‡ÙŠ"].includes(data.supportStatus)) {
            supportStatusEl.classList.add("status-expired");
          } else {
            supportStatusEl.classList.add("status-maintenance");
          }
        }
        
        // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        if (projectStatusEl) {
          projectStatusEl.textContent = data.projectStatus || "Unknown";
          projectStatusEl.className = "status-badge";
          
          if (["Live", "Ù†Ø´Ø·"].includes(data.projectStatus)) {
            projectStatusEl.classList.add("status-active");
          } else if (["Maintenance", "ØµÙŠØ§Ù†Ø©"].includes(data.projectStatus)) {
            projectStatusEl.classList.add("status-maintenance");
          } else {
            projectStatusEl.classList.add("status-expired");
          }
        }
        
        // Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        const projectUrl = data.projectUrl || data.url || "#";
        if (projectUrlLink) {
          projectUrlLink.textContent = projectUrl !== "#" ? projectUrl : "N/A";
          projectUrlLink.href = projectUrl !== "#" ? projectUrl : "#";
        }

        // Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ¥Ø®ÙØ§Ø¡ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        if (loginPage) loginPage.classList.add("hidden");
        if (portalPage) portalPage.classList.remove("hidden");
      }

      // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
      function saveSession(data) {
        const sessionData = {
          customerName: data.customerName || "Unknown Customer",
          projectId: data.projectId || "Unknown",
          projectName: data.projectName || "Unknown Project",
          deploymentDate: data.deploymentDate || "N/A",
          supportEndDate: data.supportEndDate || "N/A",
          supportStatus: data.supportStatus || "Unknown",
          projectStatus: data.projectStatus || "Unknown",
          projectUrl: data.projectUrl || data.url || "#",
        };

        localStorage.setItem("portalSession", JSON.stringify(sessionData));
      }

      // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
      function formatDate(date) {
        return new Date(date).toLocaleDateString(
          currentLang === "ar" ? "ar-EG" : "en-US",
          {
            year: "numeric",
            month: "short",
            day: "numeric",
          }
        );
      }

      // ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      async function checkExistingSession() {
        const savedSession = localStorage.getItem("portalSession");
        if (savedSession) {
          try {
            showPortal(JSON.parse(savedSession));
          } catch (e) {
            console.error("Error parsing saved session:", e);
            localStorage.removeItem("portalSession");
          }
        }
      }

      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„Ù…Ø§Øª URL
      function getUrlParams() {
        try {
          const params = new URLSearchParams(window.location.search);
          return {
            url: params.get('url'),
            id: params.get('id')
          };
        } catch (error) {
          console.warn("Error parsing URL parameters:", error);
          return { url: null, id: null };
        }
      }

      // Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ù† Ù…Ø¹Ù„Ù…Ø§Øª URL
      async function autoFillFromUrlParams() {
        const params = getUrlParams();
        if (!params.url && !params.id) return;
        
        const [projectUrlEl, projectIdEl] = await Promise.all([
          waitForElement('projectUrl', 1500),
          waitForElement('projectId', 1500)
        ]);
        
        if (projectUrlEl && params.url) {
          projectUrlEl.value = params.url;
        }
        
        if (projectIdEl && params.id) {
          projectIdEl.value = params.id;
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
        if (isDemoMode && params.url && params.id) {
          setTimeout(() => {
            const loginForm = byId('loginForm');
            if (loginForm && projectUrlEl.value && projectIdEl.value) {
              loginForm.requestSubmit();
            }
          }, 600);
        }
      }

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      async function initApp() {
        if (appInitialized) return;
        appInitialized = true;
        
        console.log("ğŸš€ Initializing Project Portal...");
        
        // ÙƒØ´Ù Ø§Ù„Ø¨ÙŠØ¦Ø©
        detectEnvironment();
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        if (!isDemoMode) {
          initFirebase();
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ØºØ©
        await initLanguage();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
        updateWarnings();
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        const [langSwitch, loginForm, logoutBtn] = await Promise.all([
          waitForElement("langSwitch", 1500),
          waitForElement("loginForm", 1500),
          waitForElement("logoutBtn", 1500)
        ]);
        
        if (langSwitch) {
          langSwitch.addEventListener("click", toggleLanguage);
        }
        
        if (loginForm) {
          loginForm.addEventListener("submit", handleLogin);
        }
        
        if (logoutBtn) {
          logoutBtn.addEventListener("click", handleLogout);
        }
        
        // Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ù† Ù…Ø¹Ù„Ù…Ø§Øª URL
        await autoFillFromUrlParams();
        
        // ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        await checkExistingSession();
        
        console.log(isDemoMode ? "âœ… Application initialized in DEMO MODE" : "âœ… Application initialized in REAL MODE");
      }

      // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ DOM
      window.addEventListener('load', initApp);

      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
      window.onerror = function(message, source, lineno, colno, error) {
        console.error("âŒ Global error caught:", { message, source, lineno, colno, error });
        return true;
      };

      window.addEventListener('unhandledrejection', function(event) {
        console.error("âŒ Unhandled promise rejection:", event.reason);
        event.preventDefault();
      });
    </script>
  </body>
</html>
