<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Portal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --bg-dark: #121212;
      --bg-card: #1e1e1e;
      --text: #e0e0e0;
      --primary: #bb86fc;
      --danger: #cf6679;
      --success: #03dac6;
      --border-radius: 12px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Segoe UI", system-ui, sans-serif;
      background-color: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
    }

    .lang-switch {
      position: fixed;
      top: 15px;
      right: 15px;
      background: var(--bg-card);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      font-weight: bold;
      border: 1px solid #333;
    }

    .container { width: 100%; max-width: 900px; margin: 20px auto; }
    .card {
      background: var(--bg-card);
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .card-header {
      background: #2d2d2d;
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #333;
    }

    .logo { font-size: 1.8rem; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .card-title { font-size: 1.5rem; font-weight: 600; }

    .card-body { padding: 25px; }

    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 500; }
    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #333;
      border-radius: 6px;
      background: #2d2d2d;
      color: var(--text);
      font-size: 1rem;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 6px;
      background: var(--primary);
      color: white;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-website {
      background: var(--success);
      padding: 10px;
      text-align: center;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      display: inline-block;
      margin-top: 5px;
    }

    .btn-website:hover {
      background: #02b8a5;
    }

    .alert {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 500;
    }

    .alert-error { background: rgba(207, 102, 121, 0.2); color: #f44336; }
    .alert-success { background: rgba(3, 218, 198, 0.2); color: #4caf50; }

    /* Grid - Mobile Responsive */
    .project-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .project-item {
      background: #252525;
      padding: 16px;
      border-radius: 8px;
    }

    .project-label {
      font-size: 0.85rem;
      color: #aaa;
      margin-bottom: 6px;
    }

    .project-value { font-weight: 600; font-size: 1rem; }

    /* Status Dot with Pulse */
    .status-dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 6px;
      vertical-align: middle;
    }

    .status-live .status-dot {
      background-color: #4caf50;
      box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
      70% { box-shadow: 0 0 0 8px rgba(76, 175, 80, 0); }
      100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
    }

    .status-developing .status-dot { background-color: #ff9800; }
    .status-closed .status-dot { background-color: #9e9e9e; }
    .status-fixing .status-dot { background-color: #f44336; }

    /* Support Status Badges */
    .support-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: bold;
      display: inline-block;
      min-width: 90px;
      text-align: center;
    }

    .support-active { background-color: #2e7d32; color: white; }
    .support-expire-soon { background-color: #ff9800; color: white; }
    .support-expired { background-color: #d32f2f; color: white; }
    .support-unlimited { background-color: #03dac6; color: white; }

    .hidden { display: none; }

    footer {
      text-align: center;
      padding: 20px;
      color: #777;
      font-size: 0.9rem;
    }

    /* RTL Support */
    [dir="rtl"] .status-dot { margin-left: 0; margin-right: 6px; }
    [dir="rtl"] .project-grid { direction: rtl; }

    @media (max-width: 600px) {
      .project-grid { grid-template-columns: 1fr; }
      .card-body { padding: 20px 15px; }
      .lang-switch { top: 10px; right: 10px; }
    }
  </style>
</head>
<body>
  <div class="lang-switch" id="langSwitch">EN</div>

  <div class="container">
    <!-- Login -->
    <div id="loginPage" class="card">
      <div class="card-header">
        <div class="logo"><i class="fas fa-lock"></i></div>
        <div class="card-title" data-key="loginTitle">Project Portal Login</div>
      </div>
      <div class="card-body">
        <div id="loginAlert" class="alert hidden"></div>
        
        <!-- Firebase Configuration Warning -->
        <div id="configWarning" class="alert alert-error hidden">
          <strong>Configuration Required:</strong> Firebase is not configured.<br>
          Replace the <code>firebaseConfig</code> object with your project details.
        </div>

        <!-- Connection Error -->
        <div id="connectionError" class="alert alert-error hidden">
          <strong>Connection Issue:</strong> Unable to connect to Firebase.<br>
          Please run from a web server (e.g., GitHub Pages, Live Server).
        </div>

        <form id="loginForm">
          <div class="form-group">
            <label data-key="urlField">Project URL</label>
            <input type="url" id="projectUrl" placeholder="https://yourproject.com" required />
          </div>
          <div class="form-group">
            <label data-key="idField">Project ID</label>
            <input type="text" id="projectId" placeholder="PROJ-123" required />
          </div>
          <button type="submit" class="btn" data-key="loginBtn">Login</button>
        </form>
      </div>
    </div>

    <!-- Portal -->
    <div id="portalPage" class="card hidden">
      <div class="card-header">
        <div class="logo"><i class="fas fa-tachometer-alt"></i></div>
        <div class="card-title" data-key="portalTitle">Project Dashboard</div>
      </div>
      <div class="card-body">
        <div class="alert alert-success" id="welcomeMessage">
          <span data-key="welcomeMsg">Welcome,</span> <strong id="customerNameDisplay"></strong>!
        </div>

        <div class="project-grid">
          <div class="project-item">
            <div class="project-label" data-key="customerName">Customer Name</div>
            <div class="project-value" id="customerName"></div>
          </div>
          <div class="project-item">
            <div class="project-label" data-key="projectId">Project ID</div>
            <div class="project-value" id="projectIdDisplay"></div>
          </div>
          <div class="project-item">
            <div class="project-label" data-key="projectName">Project Name</div>
            <div class="project-value" id="projectName"></div>
          </div>
          <div class="project-item">
            <div class="project-label" data-key="deploymentDate">Deployment Date</div>
            <div class="project-value" id="deploymentDate"></div>
          </div>
          <div class="project-item">
            <div class="project-label" data-key="supportEndDate">Support Ends</div>
            <div class="project-value" id="supportEndDate"></div>
          </div>
          <div class="project-item">
            <div class="project-label" data-key="projectStatus">Project Status</div>
            <div class="project-value" id="projectStatus"></div>
          </div>
          <div class="project-item">
            <div class="project-label" data-key="projectUrl">Project Website</div>
            <div class="project-value">
              <a href="#" id="projectUrlBtn" class="btn-website" target="_blank" data-key="visitSite">Visit Site</a>
            </div>
          </div>
          <div class="project-item">
            <div class="project-label" data-key="supportStatus">Support Status</div>
            <div class="project-value">
              <span id="supportStatus" class="support-badge"></span>
            </div>
          </div>
        </div>

        <button class="btn" style="background:#6c757d;" id="logoutBtn" data-key="logoutBtn">Logout</button>
      </div>
    </div>
  </div>

  <footer data-key="footerText">Project Portal &copy; 2026</footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // üîë ÿßÿ≥ÿ™ÿ®ÿØŸÑ Ÿáÿ∞Ÿá ÿßŸÑŸÇŸäŸÖ ÿ®ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ¥ÿ±ŸàÿπŸÉ ŸÅŸä Firebase Console
    const firebaseConfig = {
      apiKey: "AIzaSyAemoGMX1PHF55qUTh_5SZIrN3Y-QaqrWA",
      authDomain: "yossef-dev-216b0.firebaseapp.com",
      projectId: "yossef-dev-216b0",
      storageBucket: "yossef-dev-216b0.firebasestorage.app",
      messagingSenderId: "509948939620",
      appId: "1:509948939620:web:017b806e995bb114d8be71",
    };

    // üåê ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿßÿ™
    const translations = {
      en: {
        loginTitle: "Project Portal Login",
        urlField: "Project URL",
        idField: "Project ID",
        loginBtn: "Login",
        portalTitle: "Project Dashboard",
        welcomeMsg: "Welcome,",
        customerName: "Customer Name",
        projectId: "Project ID",
        projectName: "Project Name",
        deploymentDate: "Deployment Date",
        supportEndDate: "Support Ends",
        projectStatus: "Project Status",
        projectUrl: "Project Website",
        visitSite: "Visit Site",
        supportStatus: "Support Status",
        logoutBtn: "Logout",
        footerText: "Project Portal &copy; 2026",
        loginError: "Invalid Project ID or URL",
        unlimitedSupport: "Unlimited Support",
        endsIn: (days) => `Ends in ${days} day${days !== 1 ? 's' : ''}`,
        endsToday: "Ends today",
        ended: (days) => `Ended ${days} day${days !== 1 ? 's' : ''} ago`
      },
      ar: {
        loginTitle: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑÿ®Ÿàÿßÿ®ÿ©",
        urlField: "ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
        idField: "ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
        loginBtn: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
        portalTitle: "ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
        welcomeMsg: "ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå",
        customerName: "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ",
        projectId: "ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
        projectName: "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
        deploymentDate: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜÿ¥ÿ±",
        supportEndDate: "ŸäŸÜÿ™ŸáŸä ÿßŸÑÿØÿπŸÖ",
        projectStatus: "ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
        projectUrl: "ŸÖŸàŸÇÿπ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ",
        visitSite: "ÿ≤Ÿäÿßÿ±ÿ© ÿßŸÑŸÖŸàŸÇÿπ",
        supportStatus: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿØÿπŸÖ",
        logoutBtn: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
        footerText: "ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ &copy; 2026",
        loginError: "ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ£Ÿà ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠",
        unlimitedSupport: "ÿØÿπŸÖ ÿ∫Ÿäÿ± ŸÖÿ≠ÿØŸàÿØ",
        endsIn: (days) => `ŸäŸÜÿ™ŸáŸä ÿÆŸÑÿßŸÑ ${days} ŸäŸàŸÖ${days !== 1 ? 'ŸäŸÜ' : ''}`,
        endsToday: "ŸäŸÜÿ™ŸáŸä ÿßŸÑŸäŸàŸÖ",
        ended: (days) => `ÿßŸÜÿ™ŸáŸâ ŸÖŸÜÿ∞ ${days} ŸäŸàŸÖ${days !== 1 ? 'ŸäŸÜ' : ''}`
      }
    };

    let currentLang = localStorage.getItem('lang') || 'en';
    const rtlLangs = ['ar'];
    let db = null;
    let firebaseReady = false;

    // üîÑ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©
    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('lang', lang);
      document.documentElement.setAttribute('lang', lang);
      document.documentElement.setAttribute('dir', rtlLangs.includes(lang) ? 'rtl' : 'ltr');
      
      document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.getAttribute('data-key');
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });
      document.getElementById('langSwitch').textContent = lang.toUpperCase();
      updateDynamicContent();
    }

    // üìÖ ÿ™ŸÜÿ≥ŸäŸÇ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿØÿπŸÖ
    function formatSupportDate(endDateStr) {
      if (!endDateStr || endDateStr.trim().toLowerCase() === 'un') {
        return `<span class="support-badge support-unlimited">${translations[currentLang].unlimitedSupport}</span>`;
      }

      let date;
      if (endDateStr.includes('-')) {
        const [d, m, y] = endDateStr.split('-');
        date = new Date(`${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`);
      } else {
        date = new Date(endDateStr);
      }

      if (isNaN(date.getTime())) return `<span class="support-badge support-expired">${endDateStr}</span>`;

      const now = new Date();
      const diffDays = Math.ceil((date - now) / 86400000);

      if (diffDays > 7) {
        return date.toLocaleDateString(rtlLangs.includes(currentLang) ? 'ar-EG' : 'en-GB');
      } else if (diffDays > 0) {
        return translations[currentLang].endsIn(diffDays);
      } else if (diffDays === 0) {
        return translations[currentLang].endsToday;
      } else {
        return translations[currentLang].ended(Math.abs(diffDays));
      }
    }

    // üõ†Ô∏è ÿ™ŸÜÿ≥ŸäŸÇ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ
    function formatProjectStatus(status) {
      let dotClass = '';
      let text = status || 'Unknown';
      if (status === 'Live') dotClass = 'status-live';
      else if (status === 'Under Development') { dotClass = 'status-developing'; text = 'Under Development'; }
      else if (status === 'Closed') { dotClass = 'status-closed'; text = 'Closed'; }
      else if (status === 'Fixing Bugs') { dotClass = 'status-fixing'; text = 'Fixing Bugs'; }

      return `<span class="${dotClass}">${text}<span class="status-dot"></span></span>`;
    }

    // üé® ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿØŸäŸÜÿßŸÖŸäŸÉŸäÿ©
    function updateDynamicContent() {
      const supportEl = document.getElementById('supportEndDate');
      const statusEl = document.getElementById('projectStatus');
      const supportStatusEl = document.getElementById('supportStatus');
      
      if (supportEl?.dataset.raw) supportEl.innerHTML = formatSupportDate(supportEl.dataset.raw);
      if (statusEl?.dataset.raw) statusEl.innerHTML = formatProjectStatus(statusEl.dataset.raw);
      if (supportStatusEl?.dataset.raw) {
        const raw = supportStatusEl.dataset.raw;
        let cls = 'support-expired';
        if (raw === 'Active') cls = 'support-active';
        else if (raw === 'Expire Soon') cls = 'support-expire-soon';
        supportStatusEl.className = `support-badge ${cls}`;
        supportStatusEl.textContent = raw;
      }
    }

    // üöÄ ÿ™ŸáŸäÿ¶ÿ© Firebase
    function initFirebase() {
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        firebaseReady = true;
        document.getElementById('configWarning').classList.add('hidden');
        return true;
      } catch (e) {
        console.error("Firebase init failed:", e);
        document.getElementById('configWarning').classList.remove('hidden');
        return false;
      }
    }

    // üö™ ÿπÿ±ÿ∂ ÿßŸÑÿ®Ÿàÿßÿ®ÿ©
    function showPortal(data) {
      document.getElementById('customerNameDisplay').textContent = data.customerName;
      document.getElementById('customerName').textContent = data.customerName;
      document.getElementById('projectIdDisplay').textContent = data.projectId;
      document.getElementById('projectName').textContent = data.projectName;
      document.getElementById('deploymentDate').textContent = data.deploymentDate || '‚Äî';
      
      const supportEl = document.getElementById('supportEndDate');
      supportEl.dataset.raw = data.supportEndDate;
      supportEl.innerHTML = formatSupportDate(data.supportEndDate);
      
      const statusEl = document.getElementById('projectStatus');
      statusEl.dataset.raw = data.projectStatus;
      statusEl.innerHTML = formatProjectStatus(data.projectStatus);
      
      const supportStatusEl = document.getElementById('supportStatus');
      supportStatusEl.dataset.raw = data.supportStatus || 'Unknown';
      const rawStatus = data.supportStatus || 'Unknown';
      let cls = 'support-expired';
      if (rawStatus === 'Active') cls = 'support-active';
      else if (rawStatus === 'Expire Soon') cls = 'support-expire-soon';
      supportStatusEl.className = `support-badge ${cls}`;
      supportStatusEl.textContent = rawStatus;
      
      document.getElementById('projectUrlBtn').href = data.url;
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('portalPage').classList.remove('hidden');
    }

    // ‚öôÔ∏è ÿ®ÿØÿ° ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
    window.addEventListener('load', () => {
      setLanguage(currentLang);
      
      // ÿ™ŸáŸäÿ¶ÿ© Firebase
      if (!initFirebase()) return;
      
      // ŸÖŸÑÿ° ŸÖŸÜ ÿßŸÑÿ±ÿßÿ®ÿ∑ (ÿ•ÿ∞ÿß ŸàŸèÿ¨ÿØ)
      const urlParams = new URLSearchParams(window.location.search);
      const url = urlParams.get('url');
      const id = urlParams.get('id');
      if (url && id) {
        document.getElementById('projectUrl').value = url;
        document.getElementById('projectId').value = id;
      }

      // ÿ£ÿ≠ÿØÿßÿ´
      document.getElementById('langSwitch').onclick = () => {
        setLanguage(currentLang === 'en' ? 'ar' : 'en');
      };
      
      document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const url = document.getElementById('projectUrl').value.trim();
        const id = document.getElementById('projectId').value.trim();
        
        if (!firebaseReady) {
          document.getElementById('connectionError').classList.remove('hidden');
          return;
        }

        try {
          // ÿ™Ÿàÿ≠ŸäÿØ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÑŸÑŸÖŸÇÿßÿ±ŸÜÿ©
          const normalize = (u) => u.replace(/^(https?:\/\/)?(www\.)?/, '').replace(/\/$/, '').toLowerCase();
          const normInput = normalize(url);
          
          const snapshot = await db.collection('projects').doc(id).get();
          if (!snapshot.exists) throw new Error(translations[currentLang].loginError);
          
          const data = snapshot.data();
          if (normalize(data.url) !== normInput) throw new Error(translations[currentLang].loginError);
          
          data.projectId = id;
          showPortal(data);
        } catch (err) {
          const alertEl = document.getElementById('loginAlert');
          alertEl.textContent = err.message || translations[currentLang].loginError;
          alertEl.className = 'alert alert-error';
          alertEl.classList.remove('hidden');
        }
      });
      
      document.getElementById('logoutBtn')?.addEventListener('click', () => {
        document.getElementById('portalPage').classList.add('hidden');
        document.getElementById('loginPage').classList.remove('hidden');
        document.getElementById('loginForm').reset();
        document.getElementById('loginAlert').classList.add('hidden');
      });
    });
  </script>
</body>
</html>
